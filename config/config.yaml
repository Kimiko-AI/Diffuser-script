# Training Configuration

output_dir: "zimage-wds-training-2"
seed: 42
report_to: "wandb"
validation_prompt:
  - "mean_luminance: 0.73 std_luminance: 0.15 low_freq_energy: 10.70 high_freq_energy: 4.29 edge_density: 0.04 | general, hatsune_miku, 1girl, absurdly_long_hair, aqua_eyes, aqua_hair, aqua_theme, blue_jacket, blue_sky, blue_sweater, building, city, cityscape, colored_skin, floating_hair, from_side, jacket, limited_palette, long_hair, looking_up, monochrome, open_clothes, open_jacket, open_mouth, oversized_clothes, pale_skin, profile, puffy_sleeves, rooftop, sky, solo, sweater, twintails, very_long_hair, white_skin"
  - "mean_luminance: 0.66 std_luminance: 0.27 low_freq_energy: 11.98 high_freq_energy: 4.53 edge_density: 0.09 | general, 1boy, androgynous, flower, fox, grey_eyes, grey_hair, lying, male_focus, on_back, pale_skin, school_uniform, serafuku, solo, upturned_eyes, white_flower, white_hair"
  - "mean_luminance: 0.57 std_luminance: 0.41 low_freq_energy: 12.67 high_freq_energy: 7.56 edge_density: 0.06 | general, 2boys, :d, apron, arm_hair, black_hair, black_pants, black_shirt, bodysuit, bomb, cape, chef_hat, comic, counter, doorway, explosive, facial_hair, frown, gloves, hat, holding, long_nose, male_focus, meme, multiple_boys, mustache, open_mouth, orange_cape, pants, shirt, short_hair, short_sleeves, silent_comic, smile, squinting, teeth, white_apron, white_gloves, white_hat, yellow_bodysuit, yellow_hat"
  - "mean_luminance: 0.49 std_luminance: 0.23 low_freq_energy: 11.67 high_freq_energy: 5.54 edge_density: 0.13 | general, asahina_aoi, kirigiri_kyoko, 2girls, belt, black_belt, black_gloves, black_jacket, black_skirt, blue_eyes, bottle, brown_hair, dark-skinned_female, dark_skin, gloves, grey_hair, hair_ornament, hand_up, holding, holding_bottle, jacket, ketchup, ketchup_bottle, long_hair, lying, multiple_girls, necktie, official_alternate_costume, on_back, one_eye_closed, open_clothes, open_jacket, pencil_skirt, ponytail, short_hair, shorts, skirt, tongue, tongue_out"
  - "mean_luminance: 0.58 std_luminance: 0.26 low_freq_energy: 11.46 high_freq_energy: 4.16 edge_density: 0.06 | general, 2girls, beach, black_hair, black_skirt, blouse, blue_neckerchief, blue_sailor_collar, blurry, blurry_background, collarbone, hand_on_another's_shoulder, leaning_on_person, lens_flare, long_hair, medium_hair, multiple_girls, neckerchief, ocean, outdoors, pleated_skirt, purple_eyes, reflection, reflective_water, sailor_collar, school_uniform, serafuku, shirt, short_sleeves, skirt, standing, white_shirt"
  - "mean_luminance: 0.53 std_luminance: 0.22 low_freq_energy: 12.33 high_freq_energy: 5.07 edge_density: 0.12 | general, 1girl, animal_ears, artist_name, bare_legs, barefoot, blush, breasts, english_text, green_eyes, grey_background, long_sleeves, looking_at_viewer, multicolored_hair, nose, open_mouth, short_hair, simple_background, solo, tentacle_hair, toes"
  - "mean_luminance: 0.29 std_luminance: 0.25 low_freq_energy: 11.64 high_freq_energy: 4.28 edge_density: 0.07 | general, 1girl, aqua_gemstone, blue_background, blue_gemstone, brown_eyes, claw_ring, colored_eyelashes, dripping, ear_piercing, earrings, fingernails, gem, gold, gold_earrings, gold_ring, gradient_background, green_gemstone, hands_on_own_face, jewelry, liquid, looking_up, multiple_earrings, nose_piercing, nose_ring, ornate_ring, parted_lips, piercing, pink_gemstone, purple_gemstone, red_gemstone, ribbon, ring, sharp_fingernails, signature, solo, surreal, upper_body, yellow_nails"
  - "mean_luminance: 0.91 std_luminance: 0.23 low_freq_energy: 12.17 high_freq_energy: 7.29 edge_density: 0.17 | general, chen, chen_(cat), kaenbyou_rin, kaenbyou_rin_(cat), kazami_yuuka, !, 1girl, biting, cat, comic, dreaming, flower, greyscale, hat, monochrome, multiple_tails, sleeping, sunflower, tail, two_tails"

validation_steps: 500

# Optimization
learning_rate: 3.0e-4
afm_lambda: 0
consistency_lambda: 0
max_grad_norm: 1.0
lr_scheduler_type: "cosine" # Options: "linear", "cosine", "cosine_with_restarts", "polynomial", "constant", "constant_with_warmup"
lr_warmup_steps: 500
mixed_precision: "bf16"
gradient_accumulation_steps: 1
gradient_checkpointing: true
use_ema: true
ema_decay: 0.9999
ema_update_after_step: 0
resume_from_checkpoint: "latest" # "latest" or path to checkpoint directory
checkpointing_steps: 500
checkpoints_total_limit: 3
# Data (WebDataset)
#data_url: "pipe:curl -s -L https://huggingface.co/datasets/DSULT-Alya/Renai-Circulation-bucketized-crossing-field/resolve/main/0000/bucket_00{{00..99}}_000000.tar -H 'Authorization:Bearer '"
data_url: "/workspace/shinon/anime/train/000{01..37}.tar"
resolution: 256 # Base resolution (int or [w, h])
bucket_step_size: 32
train_batch_size: 128
dataloader_num_workers: 32
max_train_steps: 100000

# Timestep Sampling
timestep_sampling:
  weighting_scheme: "uniform" # Options: "cosmap", "logit_normal", "uniform"
  logit_mean: 0.0
  logit_std: 1.0
  mode_scale: 1.29

# Model Configuration (Pretrain from Scratch)
pretrained_model_name_or_path: "Tongyi-MAI/Z-Image-Turbo"
text_encoder_path: "Tongyi-MAI/Z-Image-Turbo"
vae_path: "Tongyi-MAI/Z-Image-Turbo"
transformer_class_path: "diffusers.ZImageTransformer2DModel"
caption_dropout_prob: 0.1
model_config: false
#model_config:
#    all_f_patch_size:
#      - 1
#    all_patch_size:
#      - 2
#    axes_dims:
#      - 32
#      - 48
#      - 48
#    axes_lens:
#      - 1536
#      - 512
#      - 512
#    cap_feat_dim: 640
#    dim: 768
#    in_channels: 16
#    n_heads: 6
#    n_kv_heads: 6
#    n_layers: 8
#    n_refiner_layers: 2
#    #norm_eps: 1e-05
#    qk_norm: true
#    rope_theta: 256.0
#    t_scale: 1000.0